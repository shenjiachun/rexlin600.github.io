---
layout: post
title: "1. 什么是微服务"
date: 1997-07-01
categories: Microservices
tags: microservice
excerpt: 了解微服务的基本概念、历史、发展以及和传统服务对比等等
mathjax: true
---

## 了解微服务前

> 在我们学习了解微服务前，我们需要知道我们之前所依赖和仰仗的单体服务和微服务之间的对比，各自的优缺点从而让我们明确什么时候需要微服务以及我们我们在学习微服务、运用微服务到生产过程中需要掌握的基本概念知识等。

***

## Microservices vs Monolithic Architecture

> 专业的说法就是`Microservices vs Monolithic Architecture`，我们一般翻译为微服务和单体应用的对比，下面将逐步描述从单体应用到微服务化的过程。
> 
> 大致上可以按照这个方向理解：
> 
> `单体服务` -> `SOA服务化` -> `微服务`

### 单体服务

单体服务作为我们可能比较常见的服务架构模式，相信大家都很熟悉，但是大家可能平时并没有去关心过相关概念和知识，这里简单描述一下单体服务的模式和相关背景

1. 架构层面上：单体服务一般作为单一性的系统架构，它的所有进程都紧密合并在一起并作为一个服务在运行。
2. 背景上：在早期，一般公司的技术架构分为两大类：LAMP和MVC架构。他们的优点是：学习成本低、开发周期短、部署、运维方便，另外还有开发成本比较低、不缺人维护等等。

当然，早起可能业务体量没有那么大，可能单体服务足以支撑我们的大多数公司的需求。随着业务体量的增加，公司急需在技术上进行更新换代以支撑未来市场的发展，所以单体服务的相关弊病就暴露了出来了：

1. 一个项目可能需要一个庞大的团队进行协作，协作繁杂、管理难度极大；随着项目的复杂度变大，开发人员使用相关工具进行开发的效率也很低，你能想象一个debug调试搞几天吗？
2. 迫切的需要持续集成、持续交付，你能想象一个庞大的项目部署发布需要几个小时甚至几天的吗？
3. 新技术落地难度大、项目难以跟上时代步伐从而导致项目业务发展受限，难以扩展。

### SOA服务化

> 基于单体应用诸如：系统太过臃肿、更新、发布耗时耗力；团队协作难度增加、管理难度增加等诸多问题。

服务化（service-oriented architecture）即SOA的软件架构模式诞生了。请注意，服务化并不特指某项技术，以我个人来讲：可以把服务化看成传统单体应用的本地方法调用改为通过`接口`来实现的`远程方法调用`即我们常说的RPC。

那么说到这里，可能有些接触过微服务的朋友就有疑问了，那这个和微服务不差不多吗。答案是肯定的，只不过微服务在SOA软件架构的基础上有了很大的不同。

### 微服务

> 可以这么说，没有SOA软件设计方法就很难发展到现在以容器服务、DevOps等技术为首的微服务生态圈。
> 
> 最开始我和很多人一样，总是喜欢问微服务究竟是什么？如何用一句话去完整的描述。其实我觉得大家看到这里应该会对微服务是什么都有一些自己的看法和理解了。如果你认同前面这句话，那么恭喜你，说明你在思考，而不是让别人告诉你微服务是什么，后面我将会阐述什么叫微服务。
> 
> 为什么这么说呢，举个不太恰当的例子：在我们完成这个工程的过程中我们需要做很多额外的工作，比如招工人、招管理、准备工具、设计方案、排计划工期、动工、监控工期、关键时间节点把控、质量把控、交付等等。
> 
> 下面这段话是来自维基百科对于微服务的解释：
> 
> 微服务 (Microservices) 是一种`软件架构风格`，它是以专注于`单一责任与功能的`小型功能区块 (Small Building Blocks) 为基础，利用`模组化`的方式`组合出复杂的大型应用程序`，各功能区块使用`与语言无关` (Language-Independent/Language agnostic) 的 `API 集相互通讯`。

相比SOA，或者说相比服务化的软件架构设计方法，我个人觉得微服务在这些方面和服务化有着很大的区别：

1. 服务的开发、部署、维护、治理等要求更高
   > 包括服务敏捷开发、CI|CD、容器化、DevOps等等
2. 服务划分维度更宽泛
   > 服务的层级划分、服务模块的拆分颗粒度（以基础服务层为依据的横向拆分、以业务为导向的纵向拆分等）、以及DDD（领域驱动设计）的兴起等（目前国内不是很流行）
3. 技术复杂度陡增、技术版本迭代快
   > 尤其是对架构师的要求更高，这里会涉及很多技术层面的解决方案，诸如大家常见的：服务高可用、高并发、分布式事务、分布式锁、持续集成、持续交付、自动化运维、服务容器化等等常见字眼及分布式系统固有的复杂性等。
4. 管理模式的升级
   > 不同于传统服务开发，微服务开发一般需要遵照一些原则和理论，当然这个不是强制性的，一般是根据各个公司自己的实际情况来组织自己的项目、团队。这个算是我个人的一些看法，相信大家在微服务的接触中会多多少少有相关的一些感悟和见解，欢迎分享、讨论。

## 微服务定义

> 微服务只是一种软件架构风格，我们现在给它的定义可能并不准确，因为随着技术的更新迭代，它的相关定义可能在原来的基础上多多少少会有一些变化，下面将列出几个点阐述什么是微服务。

1. **Highly maintainable and testable** （高度可维护、测试）
2. **Loosely coupled** （松散耦合。我们习惯上也说低耦合、高内聚，接触过spring的都应该知道诸如耦合、解耦等概念）
3. **Independently deployable** （独立部署）
4. **Organized around business capabilities** （围绕业务能力组织）

必须记住的话：`Microservices are not a silver bullet`。

为什么这么说呢，因为随着单体服务不足以支撑相应的业务体量的过程中的产物，下一个技术的风口或许是微服务、也或许是未来有一定的趋势的`service mesh`、甚至是重返单体服务。所以我们不能说微服务一定能解决未来软件发展中的所有问题，只能说就现在而言，微服务作为一种普遍受欢迎的软件架构模式。

> 此外，在`The Art of Scalability (Addison-Wesley, 2015)`这本书提出了一种`高可用的三维模型`，即`scale cube`，如下图：
> 
> ![scale cube](/images/microservice/scale_cube.png)
> 
> 上面这个三维模型表述了软件架构中软件发展中有以下三个大致的方向：
> 
> 1. x轴：一个服务实例升级为多个服务实例（请求通过路由算法被路由到其中的一个服务实例）
> 2. z轴：一个数据分区变为多个（例如用户登陆时通过用户id、密码等经过计算从而被路由到不同的服务分区）
> 3. y轴：同一个服务实例由一个服务集群组成，请求经过负载均衡保证服务的高可用性等

